CREATE OR REPLACE FUNCTION votes(text, integer) 
RETURNS integer AS
$BODY$
  declare result integer;
  BEGIN
    select
      SUM(CASE WHEN vote = 'up' THEN 1 ELSE -1 END) as votes into result
    from
      votes 
    where
      entry_type=$1 and entry_id=$2;
    if result is null then
      return 0;
    else
      return result;
    end if;
  END; 
$BODY$ LANGUAGE plpgsql;
  
CREATE OR REPLACE FUNCTION answer(integer, out answer text, out answered timestamptz, out answered_by text) AS
$BODY$
  BEGIN
    select
      comment, comments.answered, comments.answer into answer, answered, answered_by
    from
      comments 
    where
      comments.answer is not null and question_id=$1;
  END; 
$BODY$ LANGUAGE plpgsql;

  
    
     
CREATE FUNCTION test_ret(a TEXT, b TEXT) RETURNS RECORD AS $$
DECLARE 
  ret RECORD;
BEGIN
  -- Arbitrary expression to change the first parameter
  IF LENGTH(a) < LENGTH(b) THEN
      SELECT TRUE, a || b, 'a shorter than b' INTO ret;
  ELSE
      SELECT FALSE, b || a INTO ret;
  END IF;
RETURN ret;
END;$$ LANGUAGE plpgsql;
     