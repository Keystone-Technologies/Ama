<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script src="/js/scripts.js"></script>
	<link rel="stylesheet" media="screen and (max-device-width: 800px)" href="/css/style.css">
	<link rel="stylesheet" media="screen and (min-device-width: 800px)" href="/css/desktop.css">
</head>
<title>Ask Me Anything</title>

<script>
$(document).ready(function() {
	$(".newQuestionContainer").hide();
	$(".content").hide();
	
	% for my $question (@$questions) {
		% $question->{question} =~ s/\r\n/ NEWLINEPLEASE /g;
        addQuestion(new Question(
            <%=$question->{question_id}%>,
            "<%=$question->{question}%>",
            <%=$question->{votes}%>,
            "<%=$question->{username}%>",
            "<%=$question->{created}%>",
            <%=$question->{flagged}%>,
            <%=$question->{answered}%>,
            '<%=$question->{my_vote}%>'));
    %}
    setCurrentUser("<%=session 'username'%>");
    
    var commentsLoaded = 0;
    
    var loading = $.Deferred();
    
    //loads all comments and stores them in the correct question
    for(var i = 0; i < getQuestionCount(); i ++) {
    	var id = getQuestion(i).getId();
        $.get("/questions/" + id + "/comments", function(data){
            $.each(data, function(i, v){
                var current = new Comment(v.question_id + "_" + v.comment_id, v.comment, v.votes, v.username, v.created, v.flagged, v.answered, v.my_vote);
                for(var j = 0; j < getQuestionCount(); j ++)
                {
                    if(getQuestion(j).getId() == current.getQuestId())
                    {
                        getQuestion(j).addComment(current);
                    }
                }
            });
            commentsLoaded ++;
            if(commentsLoaded == getQuestionCount()){
            	//after all of the comments are loaded, the rest of the page loads
                initializeContent();
                $(".content").show();
            }
        }, 'json');
    }
    
});
//hide all comment containers and reply containers here also
</script>

<body>
<<<<<<< HEAD
        <a href='https://www.youtube.com/channel/UCwSuyK7EsrNN02Z92bI34gA/feed' target="_blank"><img id='youtube' src='/img/youtube.png' onmouseover='youtubehover(true);' onmouseout='youtubehover(false);' data-toggle='true' title='KSTN video blog on YouTube'></a>
    <div id="newquestion">
        <h3 id="newquestionbutton">+ New Question</h3>
    </div>
    <div class="header" id="bar">
        <input class="header" id="logo" type="image" src="/img/logo.png">
        <span id='version'>v<%=$version%></span>
    </div>
    <div id="errorcontainer" class="error">
    Error: Unable to complete task
    </div>
    <div id="content">
        % for my $question (@$questions) {
            % my $question_id = $question->{question_id};
            % if (!$question->{answered}) {
                <div id="question_<%= $question_id %>" class="question<%= $question->{answered} ? 'answered' : 'unanswered' %>container">
                    <div class="questioninfocontainer">
                        <div class="votecontainer">
                            <div id="vote_<%= $question_id %>" class="vote">
                            
                                <img id="up_<%= $question_id %>" class="vote_up" src="/img/uparrow.png" onmouseover="arrowhover(this.id, this.className, 'over');" onmouseout="arrowhover(this.id, this.className, 'out');">
                                <div id="countcontainer_<%= $question_id %>" class="count">
                                    <p id="count_<%= $question_id %>" class="countnumber"><%= $question->{votes} %></p>
                                </div>
                                    <script>
                                        $(document).ready(function(){
                                            var clicked = false;
                                            console.log("up <%= $question_id %>");
                                            $("#up_<%= $question_id %>").click(function(){
                                                $(this).attr("onmouseout", "");
                                                $(this).attr("onmouseover", "");
                                                $(this).attr("src", "/img/clickeduparrow.png");
                                                $("#down_<%= $question_id %>").attr("onmouseout", "arrowhover(this.id, this.className, 'out');");
                                                $("#down_<%= $question_id %>").attr("onmouseover", "arrowhover(this.id, this.className, 'over');");
                                                $("#down_<%= $question_id %>").attr("src", "/img/downarrow.png");
                                                $.post("<%= url_for 'cast_vote', {entry_type=>'questions', entry_id=>$question_id, vote=>'up'} %>", function(data){
                                                    console.log(data);
                                                    $("#count_<%= $question_id %>").html(data.votes);
                                                }, 'json');
                                            });
                                        });
                                    </script>
                                <img id="down_<%= $question_id %>" class="vote_down" src="/img/downarrow.png" onmouseover="arrowhover(this.id, this.className, 'over');" onmouseout="arrowhover(this.id, this.className, 'out');">
                                    <script>
                                        $(document).ready(function(){
                                            console.log("down <%= $question_id %>");
                                            $("#down_<%= $question_id %>").click(function(){
                                                $(this).attr("onmouseout", "");
                                                $(this).attr("onmouseover", "");
                                                $(this).attr("src", "/img/clickeddownarrow.png");
                                                $("#up_<%= $question_id %>").attr("onmouseout", "arrowhover(this.id, this.className, 'out');");
                                                $("#up_<%= $question_id %>").attr("onmouseover", "arrowhover(this.id, this.className, 'over');");
                                                $("#up_<%= $question_id %>").attr("src", "/img/uparrow.png");
                                                $.post("<%= url_for 'cast_vote', {entry_type=>'questions', entry_id=>$question_id, vote=>'down'} %>", function(data){
                                                    console.log(data);
                                                    $("#count_<%= $question_id %>").html(data.votes);
                                                }, 'json');
                                            });
                                        });
                                    </script>
                                % if ($question->{flagged}){
                                    <script>
                                    $(document).ready(function(){
                                        $("#vote_<%= $question_id %>").css('display', 'none');
                                        $("#questionbuttoncontainer_<%= $question_id %>").prepend("<div id='flaggedcount_<%= $question_id %>' class='flaggedcount'><p class='countnumber'><%= $question->{votes} %></p></div>");
                                    });
                                    </script>
                                % }
                            </div>
                            <div id="questionbuttoncontainer_<%= $question_id %>" class="questionbuttoncontainer">
                                % if ( $question->{username} eq session 'username' ) {
                                <div class="deletecontainer">
                                    <img id="deletequestion_<%= $question_id %>" class="deletequestionbutton" src="/img/trash.png" data-toggle='tooltip' title='Delete question'>
                                </div>
                                % }
                                <div id="flagcontainer_<%= $question_id %>" class="flagcontainer">
                                    <img id="flag_<%= $question_id %>" class="flag" src="/img/flag.png" data-toggle='tooltip' title='Flag question' onmouseover='flaghover(this.id, true)' onmouseout='flaghover(this.id, false)'>
                                </div>
                                % if (!$question->{flagged}){
                                <script>
                                    $(document).ready(function(){
                                        $("#flagcontainer_<%= $question_id %>").click(function() {questionflagclick("<%= $question_id %>", "<%= $question->{votes} %>")});
                                    });
                                </script>
                                % } else {
                                <script>
                                    $(document).ready(function(){
                                        $("#flagcontainer_<%= $question_id %>").click(function(){questionredflagclick("<%= $question_id %>", "<%= $question->{votes} %>")});
                                    });
                                </script>
                                % }
                            </div>
                        </div>
                        <div id="questiontime_<%= $question_id %>" class="questiontime">
                            <h4><%= $question->{created} %></h4>
                        </div>
                    </div>
                    <script>
                        $(document).ready(function(){
                            $("#deletequestion_<%= $question_id %>").click(function(){
                                $.ajax({
                                    url: "<%= url_for 'remove_question', {question_id => $question_id} %>",
                                    type: 'DELETE',
                                    dataType: 'json'
                                }).done(function(data){
                                    if (data) {
                                        if (data.question_id){
                                            $("#question_<%= $question_id %>").remove();
                                            $("#commentcontainer_<%= $question_id %>").remove();
                                        }
                                        else if (data.error){
                                            showError(data.error, 3000);
                                        }
                                        else {
                                            showError("Error", 3000);
                                        }
                                    }
                                    else {
                                        showError("Error", 3000);
                                    }
                                });
                            });
                            $("#deletequestion_<%= $question_id %>").mouseover(function(){
                                $(this).attr("src", "/img/opentrash.png");
                            });
                            $("#deletequestion_<%= $question_id %>").mouseout(function(){
                                $(this).attr("src", "/img/trash.png");
                            });
                            
                        });
                    </script>
                    <div class="question" id="questionholder_<%= $question_id %>">
                        <h1 id="questiontitle_<%=$question_id %>" class="questionunansweredtitle"><span><%= $question->{question} %></span></h1>
                        <div id="<%= $question_id %>" class="infobar">
                            <h4 id="showcomments_<%= $question_id %>" class="info">Show Comments (<%= $question->{comment_count} %>)</h4>
                            <h4 id="reply_<%= $question_id %>" class ="info">Reply</h4>
                            % if ($question->{flagged}){
                                <script>
                                $(document).ready(function(){
                                    $("#reply_<%= $question_id %>").css('display', 'none');
                                });
                                </script>
                            % }
                        </div>
                    </div>
                    <script>
                    $(document).ready(function(){
                        $(".questionunansweredtitle").each(function(){
                            $(this).linkify({target: "_blank"});
                        });
                        $(".questionansweredtitle").each(function(){
                            $(this).linkify({target: "_blank"});
                        });
                        if("<%= $question->{username} %>" == "<%= session 'username' %>"){
                            var questionformshown = false;
                            var question = "<%= $question->{question} %>";
                            $("#questionholder_<%= $question_id %>").click(function(event){
                                if ($(event.target).attr('class') == "questionunansweredtitle"){
                                    if (!questionformshown) {
                                        var questioneditHTML = "<form id='questionform_<%= $question_id %>' class='questionform'>\
                                            <label class='questionlabel' for='question'>Edit Question</label>\
                                            <br><textarea id='questiontextarea_<%= $question_id%>' name='question' required>" + question + "</textarea>\
                                            <input type='hidden' name='question_id' value='<%= $question_id %>'>\
                                            </form><input id='questioneditsubmit_<%= $question_id%>' class='questionpostbutton' type='submit' value='Post'>\
                                            "
                                        $("#question_<%= $question_id%>").after(questioneditHTML);
                                        questionformshown = true;
                                        $("#questioneditsubmit_<%= $question_id%>").click(function(){
                                            var message = $("#questiontextarea_<%= $question_id%>").val();
                                            $.ajax({
                                                url: url_for('update_question', {question_id: "<%= $question_id%>"}),
                                                type: "PUT",
                                                contentType: "application/x-www-form-urlencoded",
                                                dataType: 'json',
                                                data: {question_id: "<%= $question_id%>", question: message}})
                                                .done(function(data){
                                                    if (data){
                                                        if (data.question_id) {
                                                            $("#questionform_<%= $question_id %>").remove();
                                                            $("#questioneditsubmit_<%= $question_id %>").remove();
                                                            $("#questiontitle_<%= $question_id %>").text(data.question);
                                                            question = data.question;
                                                            questionformshown = false;
                                                            console.log(data);
                                                        }
                                                        else if (data.error) {
                                                            showError(data.error, 3000);
                                                        }
                                                        else {
                                                            showError("Error", 3000);
                                                        }
                                                    }
                                                    else {
                                                        showError("Error", 3000);
                                                    }
                                                });
                                        });
                                        
                                    }
                                    else {
                                        $("#questionform_<%= $question_id %>").remove();
                                        $("#questioneditsubmit_<%= $question_id %>").remove();
                                        questionformshown = false;
                                    }
                                }
                            });
                        }
                        else {
                            $("#questiontitle_<%= $question_id %>").css('cursor','text');
                        }
                    });
                    </script>
                    <script>
                        $(document).ready(function(){
                            $(".replyformcontainer").toggle(false);
                            $("#reply_<%= $question_id %>").click(function(){
                                if ($("#reply_<%= $question_id %>").html() == '- Hide'){
                                    $("#reply_<%= $question_id %>").html('Reply');
                                    $("#replyformcontainer_<%= $question_id %>").toggle(false);
                                }
                                else {
                                    $("#reply_<%= $question_id %>").html('- Hide');
                                    $("#replyformcontainer_<%= $question_id %>").toggle(true);
                                }
                            });
                            $("#submit_<%= $question_id %>").click(function(){
                                var mycomment = $.trim($("#newcommenttext_<%= $question_id %>").val());
                                console.log(mycomment);
                                $.ajax({
                                    url: url_for('store_comment', {question_id: "<%= $question_id%>"}),
                                    type: "POST",
                                    contentType: "application/x-www-form-urlencoded",
                                    dataType: 'json',
                                    data: {question_id: "<%= $question_id%>", comment: mycomment.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}})
                                    .done(function(data){
                                        if (data){
                                            if (data.comment_id){
                                                $("#newcommenttext_<%= $question_id %>").val('');
                                                $("#replyformcontainer_<%= $question_id %>").toggle(false);
                                                $("#reply_<%= $question_id %>").html('Reply');
                                                if ($("#showcomments_<%= $question_id %>").html() == 'Hide Comments'){
                                                    $("#showcomments_<%= $question_id %>").trigger('click');
                                                }
                                                globalloaded = false;
                                                $("#showcomments_<%= $question_id %>").trigger('click');
                                            }
                                            else if (data.error) {
                                                showError(data.error, 3000);
                                            }
                                            else {
                                                showError("Error", 3000);
                                            }
                                        }
                                        else {
                                            showError("Error", 3000);
                                        }
                                    });
                                });
                        });
                    </script>
                </div>
                <div id="commentcontainer_<%= $question_id %>" class="commentcontainer">
                </div>
                <div id="replyformcontainer_<%= $question_id %>" class="replyformcontainer">
                    <form id='commentform_<%= $question_id %>'>
                        <label class='commentlabel' for='comment'>Comment</label>
                        <br><textarea id="newcommenttext_<%= $question_id %>" name='comment' required></textarea>
                        <input type='hidden' name='question_id' value='<%= $question_id %>'>
                    </form>
                    <input id="submit_<%= $question_id %>" class="replypostbutton" type='submit' value='Post'>
                </div>
                <script>
                    $(document).ready(function(){
                        globalloaded = true;
                        var shown = false;
                        var loaded = false;
                        $("#showcomments_<%= $question_id %>").click(function(){
                            console.log("Global loaded: " + globalloaded);
                            console.log("Loaded: " + loaded);
                            if (!globalloaded){
                                loaded = false;
                                globalloaded = true;
                            }
                            if (shown){
                                $("#commentcontainer_<%= $question_id %>").toggle(false);
                                $("#showcomments_<%= $question_id %>").html("Show Comments (<%= $question->{comment_count}%>)");
                                shown = false;
                            }
                            else {
                                if (!loaded){  //Load comments for question via post request
                                    var HTMLstring = "";
                                    $("#commentcontainer_<%= $question_id %>").html("<img class='spinner' src='/img/spinner.gif'>");
                                    $.get("<%= url_for 'comments', {question_id => $question_id} %>", function(data){
                                        $("#commentcontainer_<%= $question_id %>").html("");
                                        $.each(data, function(i, v){
                                            console.log(v);
                                            var markanswerattributes = "";
                                            var deletecommentattributes = "";
                                            var commenttextattributes = "";
                                            var commentflagattributes = "";
                                            var owned = "false";
                                                if (v.username == "<%= session 'username' %>") {
                                                    deletecommentattributes = ""
                                                    commenttextattributes = "showable='true' style='cursor:pointer'";
                                                    owned = "true";
                                                }
                                                else {
                                                    deletecommentattributes = "style='display:none'";
                                                    commenttextattributes = "style='cursor:text'";
                                                }
                                                if(1||"<%= $question->{username} %>" == "<%= session 'username' %>"){
                                                    markanswerattributes = "src='/img/checkmark.png' data-toggle='tooltip' title='Mark as answer' onclick='answerbuttonclick(" + v.comment_id + ", false, " + v.question_id + ");' \
                                                    onmouseover='answerbuttonhover(this.id, false, true);' onmouseout='answerbuttonhover(this.id, false, false);' style='cursor:pointer' showable='true'";
                                                }
                                                else {
                                                    markanswerattributes = "style='display:none'";
                                                }
                                                if (!v.flagged){
                                                    HTMLstring = HTMLstring + (
                                                        "<div id='comment_" + v.comment_id + "' class='comment'>\
                                                        <span id='commentvotecount_" + v.comment_id + "' class='commentvotecount'>" + v.votes + "</span><div id='commentvotecontainer_" + v.comment_id + "' class='commentvotecontainer'>\
                                                        <img id='commentup_" + v.comment_id + "' class='commentup' src='/img/smalluparrow.png'>\
                                                        <img id='commentdown_" + v.comment_id + "' class='commentdown' src='/img/smalldownarrow.png'></div>\
                                                        <span id='commenttime_" + v.comment_id + "' class='commenttime' ><h4>" + v.created + "</h4></span><img id='markanswer_" + v.comment_id + "' \
                                                        class='markanswerbutton' question_id='" + v.question_id + "' " + markanswerattributes + ">\
                                                        <img id='delete_" + v.comment_id + "' question_id='" + v.question_id + "' class='deletecommentbutton' src='/img/trash.png' data-toggle='tooltip' title='Delete comment' " + deletecommentattributes + ">\
                                                        <img id='commentflag_" + v.comment_id + "' question_id='" + v.question_id + "' class='flagcommentbutton' flagged='false' src='/img/flag.png' data-toggle='tooltip' title='Flag comment' onmouseover='flaghover(this.id, true);' onmouseout='flaghover(this.id, false);'>\
                                                        <span class='commenttext' id='commenttext_" + v.comment_id + "' question_id='" + v.question_id + "' data-toggle='tooltip' title='Click to edit' " + commenttextattributes + ">\
                                                        " + v.comment + "</span></div>");
                                                }
                                                else {
                                                    HTMLstring = HTMLstring + (
                                                        "<div id='comment_" + v.comment_id + "' class='comment'>\
                                                        <span id='commentvotecount_" + v.comment_id + "' class='commentvotecount'>" + v.votes + "</span><div id='commentvotecontainer_" + v.comment_id + "' class='commentvotecontainer' style='display:none'>\
                                                        <img id='commentup_" + v.comment_id + "' class='commentup' src='/img/smalluparrow.png'>\
                                                        <img id='commentdown_" + v.comment_id + "' class='commentdown' src='/img/smalldownarrow.png'></div>\
                                                        <span id='commenttime_" + v.comment_id + "' class='commenttime' ><h4>" + v.created + "</h4></span><img id='markanswer_" + v.comment_id + "' \
                                                        class='markanswerbutton' question_id='" + v.question_id + "' " + markanswerattributes + ">\
                                                        <img id='delete_" + v.comment_id + "' question_id='" + v.question_id + "' class='deletecommentbutton' src='/img/trash.png' data-toggle='tooltip' title='Delete comment' " + deletecommentattributes + ">\
                                                        <img id='commentflag_" + v.comment_id + "' question_id='" + v.question_id + "' class='flagcommentbutton' flagged='true' src='/img/redflag.png' data-toggle='tooltip' title='Unflag comment' onmouseover='redflaghover(this.id, true);' onmouseout='redflaghover(this.id, false);'>\
                                                        <span class='commenttext' style='background:#000000' id='commenttext_" + v.comment_id + "' question_id='" + v.question_id + "' data-toggle='tooltip' title='Click to edit' " + commenttextattributes + ">\
                                                        " + v.comment + "</span></div>");
                                                }
                                                
                                                
                                                $("#commentcontainer_<%= $question_id %>").html(HTMLstring);
                                                if (owned != "true"){
                                                    $("#commenttext_" + v.comment_id).linkify({target: "_blank"});
                                                    console.log("linkified commenttext" + v.comment_id);
                                                }
                                        });
                                        $(".commentup").each(function(){
                                            
                                            $(this).mouseout(function(){
                                                $(this).attr('src','/img/smalluparrow.png');
                                            });
                                            $(this).mouseover(function(){
                                                $(this).attr('src','/img/clickedsmalluparrow.png');
                                            });
                                            $(this).click(function(){
                                                var commentid = $(this).attr("id");
                                                idobject = /(\d+)/.exec(commentid);
                                                id = idobject[1];
                                                console.log(id);
                                                $(this).attr('src','/img/clickedsmalluparrow.png');
                                                $(this).unbind('mouseout');
                                                $(this).unbind('mouseover');
                                                $("#commentdown_" + id).attr('src', '/img/smalldownarrow.png');
                                                $("#commentdown_" + id).mouseout(function(){
                                                    $(this).attr('src','/img/smalldownarrow.png');
                                                });
                                                $("#commentdown_" + id).mouseover(function(){
                                                    $(this).attr('src','/img/clickedsmalldownarrow.png');
                                                });
                                                $.post(url_for('cast_vote', {entry_type: 'comments', entry_id: id, vote: 'up'}), function(data){
                                                    $("#commentvotecount_" + id).html(data.votes);
                                                }, 'json');
                                                console.log(data);
                                            });
                                        });
                                        $(".commentdown").each(function(){
                                            $(this).mouseout(function(){
                                                $(this).attr('src','/img/smalldownarrow.png');
                                            });
                                             $(this).mouseover(function(){
                                                $(this).attr('src','/img/clickedsmalldownarrow.png');
                                            });
                                            $(this).click(function(){
                                                var commentid = $(this).attr("id");
                                                idobject = /(\d+)/.exec(commentid);
                                                id = idobject[1];
                                                $(this).attr('src','/img/clickedsmalldownarrow.png');
                                                $(this).unbind('mouseout');
                                                $(this).unbind('mouseover');
                                                $("#commentup_" + id).attr('src', '/img/smalluparrow.png');
                                                $("#commentup_" + id).mouseout(function(){
                                                    $(this).attr('src','/img/smalluparrow.png');
                                                });
                                                $("#commentup_" + id).mouseover(function(){
                                                    $(this).attr('src','/img/clickedsmalluparrow.png');
                                                });
                                                $.post(url_for('cast_vote', {entry_type: 'comments', entry_id: id, vote: 'down'}), function(data){
                                                    $("#commentvotecount_" + id).html(data.votes);
                                                }, 'json');
                                                console.log('post success');
                                                console.log(data);
                                                
                                            });
                                        });
                                        
                                        $(".deletecommentbutton").each(function(){
                                            var id = $(this).attr("id");
                                            var question_id = $(this).attr("question_id");
                                            idobject = /(\d+)/.exec(id);
                                            var comment_id = idobject[1];
                                            $("#" + id).click(function(){
                                                $.ajax({
                                                    url: url_for('remove_comment', {comment_id: comment_id}), 
                                                    type: 'DELETE',
                                                    dataType: 'json'
                                                }).done(function(data){
                                                    if (data){
                                                        if (data.comment_id){
                                                            $("#comment_" + comment_id).remove();
                                                        }
                                                        else if (data.error) {
                                                            showError(data.error, 3000);
                                                        }
                                                        else {
                                                            showError("Error", 3000);
                                                        }
                                                    }
                                                    else {
                                                        showError("Error", 3000);
                                                    }
                                                });
                                            });
                                            $("#" + id).mouseover(function(){
                                                $(this).attr("src", "/img/opentrash.png");
                                            });
                                            $("#" + id).mouseout(function(){
                                                $(this).attr("src", "/img/trash.png");
                                            });
                                        });
                                        $(".markanswerbutton").each(function(){
                                            var id = $(this).attr("id");
                                            var question_id = $(this).attr("question_id");
                                            idobject = /(\d+)/.exec(id);
                                            var comment_id = idobject[1];
                                            
                                        });
                                        
                                        $(".flagcommentbutton").each(function(){
                                            var id = $(this).attr("id");
                                            var question_id = $(this).attr("question_id");
                                            idobject = /(\d+)/.exec(id);
                                            var comment_id = idobject[1];
                                            if ($(this).attr('flagged') == 'false'){
                                                $("#commentflag_" + comment_id).click(function(){commentflagclick(comment_id)});
                                            }
                                            else {
                                                $("#commentflag_" + comment_id).click(function(){commentredflagclick(comment_id)});
                                            }
                                        });
                                        
                                        $(".commenttext").each(function(){
                                            var commentid = $(this).attr("id");
                                            var question_id = $(this).attr("question_id");
                                            idobject = /(\d+)/.exec(commentid);
                                            var comment_id = idobject[1];
                                            var editformshown = false;
                                            if ($(this).attr('showable') == 'true'){
                                                var comment = $.trim($("#commenttext_" + comment_id).text());
                                                $("#" + commentid).click(function(){
                                                    if (!editformshown) {
                                                        var commenteditHTML = "<form id='editcommentform_<%= $question_id %>'><br>\
                                                            <label class='commentlabel' for='comment'>Edit Comment</label>\
                                                            <br><textarea id='textarea_" + question_id + "' name='comment' required>" + comment + "</textarea>\
                                                            <input type='hidden' name='question_id' value='<%= $question_id %>'>\
                                                            </form><input id='editsubmit_<%= $question_id%>' class='commentpostbutton' type='submit' value='Post'>"
                                                        $("#comment_" + comment_id).after(commenteditHTML);
                                                        $("#editsubmit_" + question_id).click(function(){
                                                            var message = $("#textarea_" + question_id).val();
                                                            $.ajax({
                                                                url: url_for('update_comment', {comment_id: comment_id}),
                                                                type: "PUT",
                                                                contentType: "application/x-www-form-urlencoded",
                                                                dataType: 'json',
                                                                data: {question_id: question_id, comment: message.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
                                                            }).done(function(data){
                                                                if (data) {
                                                                    if (data.comment_id){
                                                                        $("#editcommentform_<%= $question_id %>").remove();
                                                                        $("#editsubmit_<%= $question_id %>").remove();
                                                                        comment = data.comment;
                                                                        $("#textarea_<%= $question_id %>").text(comment);
                                                                        $("#commenttext_" + comment_id).text(comment);
                                                                        editformshown = false;
                                                                    }
                                                                    else if (data.error) {
                                                                        showError(data.error, 3000);
                                                                    }
                                                                }
                                                                else {
                                                                    showError("Error", 3000);
                                                                }
                                                            });
                                                        });
                                                        editformshown = true;
                                                    }
                                                    else {
                                                        $("#editcommentform_<%= $question_id %>").remove();
                                                        $("#editsubmit_<%= $question_id %>").remove();
                                                        editformshown = false;
                                                    }
                                                });
                                            }
                                        });
                                    }, 'json');
                                    loaded = true;
                                }
                                shown = true;
                                $("#commentcontainer_<%= $question_id %>").toggle(true);
                                $("#showcomments_<%= $question_id %>").html("Hide Comments");
                                console.log('Comments displayed');
                            }
                        });
                    });
                </script>
                    </div>
                % if ($question->{flagged}){
                    <script>
                    $(document).ready(function(){
                        $("#questiontitle_<%= $question_id%>").css('background', '#000000');
                        $("#flag_<%= $question_id%>").attr('src', '/img/redflag.png');
                        $("#flag_<%= $question_id%>").attr('onmouseover', 'redflaghover(this.id, true)');
                        $("#flag_<%= $question_id%>").attr('onmouseout', 'redflaghover(this.id, false)');
                        $("#flag_<%= $question_id%>").attr('title', 'Unflag Question');
                    });
                    </script>
                % }
                    
                    
            % } else {
                <div id="question_<%= $question_id %>" class="questionansweredcontainer">
<table>
<tr>
<td>
                    <div class="questioninfocontainer">
                        <div class="answeredquestionbuttoncontainer">
                        <div class="answeredcount">
                            <p id="count_<%= $question_id %>" class="countnumber"><%= $question->{votes} %></p>
                        </div>
                        </div>
                        <div id="questiontime_<%= $question->{id} %>" class="questiontime">
                            <h4><%= $question->{created} %></h4>
                        </div>
                    </div>
</td>
<td style="align: left">
                    <div class="question" style="align: left">
                        <h1 class="questionansweredtitle"><span style="align: left"><%= $question->{question} %></span></h1>
                        <div id="<%= $question_id %>" class="infobar">
                            <h4 id="showcomments_<%= $question_id %>" class="info">Show Comments (<%= $question->{comment_count} %>)</h4>
                        </div>
                    </div>
</td>
</tr>
</table>
                </div>
                <div id="commentcontainer_<%= $question_id %>" class="commentcontainer">
                </div>
                <script>
                    $(document).ready(function(){
                        var shown = false;
                        var loaded = false;
                        $("#showcomments_<%= $question_id %>").click(function(){
                            if (shown){
                                $("#commentcontainer_<%= $question_id %>").toggle(false);
                                $("#showcomments_<%= $question_id %>").html("Show Comments (<%= $question->{comment_count} %>)");
                                shown = false;
                            }
                            else {
                                if (!loaded){
                                    var HTMLstring = "";
                                    console.log('Loading comment data');
                                    $("#commentcontainer_<%= $question_id %>").html("<img class='spinner' src='/img/spinner.gif'>");
                                    $.get("<%= url_for 'comments', {question_id => $question_id} %>", function(data){
                                        console.log(data);
                                        $("#commentcontainer_<%= $question_id %>").html("");
                                        $.each(data, function(i, v){
                                            var markanswerattributes = "";
                                            var commentbackground = "";
                                                if ("<%=$question->{username} %>" == "<%= session 'username' %>") {
                                                    if (v.answered){
                                                        markanswerattributes = "src='/img/checkedcheckmark.png' onclick='answerbuttonclick(" + v.comment_id + ", true, " + v.question_id + ");' onmouseover='answerbuttonhover(this.id, true, true);'\
                                                        onmouseout='answerbuttonhover(this.id, true, false);' data-toggle='tooltip' answered='true' title='Unmark as answer' style='cursor:pointer'";
                                                        commentbackground = "style='background:#ffffff'";
                                                    }
                                                    else {
                                                        markanswerattributes = "src='/img/checkmark.png' data-toggle='tooltip' title='Mark as answer' onclick='answerbuttonclick(" + v.comment_id + ", false, " + v.question_id + ");' \
                                                        onmouseover='answerbuttonhover(this.id, false, true);' onmouseout='answerbuttonhover(this.id, false, false);' style='cursor:pointer'";
                                                    }
                                                }
                                                else {
                                                    if (v.answered){
                                                        markanswerattributes = "src='/img/checkedcheckmark.png' answered='true'";
                                                        commentbackground = "style='background:#ffffff'";
                                                    }
                                                    else {
                                                        markanswerattributes = "style='display:none'";
                                                    }
                                                }
                                            HTMLstring = HTMLstring + (
                                                "<div id='comment_" + v.comment_id + "' class='answeredcomment' " + commentbackground + " >\
                                                <span id='commentvotecount_" + v.comment_id + "' class='commentvotecount'>" + v.votes + "</span>\
                                                <span id='commenttime_" + v.comment_id + "' class='commenttime' ><h4>" + v.created + "</h4></span><img id='markanswer_" + v.comment_id + "' \
                                                class='markanswerbutton' question_id='" + v.question_id + "' " + markanswerattributes + ">\
                                                <span class='commenttext' id='commenttext_" + v.comment_id + "' question_id='" + v.question_id + "' >\
                                                " + v.comment + "</span></div>");
                                                $("#commentcontainer_<%= $question_id %>").html(HTMLstring);
                                        });
                                    }, 'json');
                                    loaded = true;
                                }
                                shown = true;
                                $("#commentcontainer_<%= $question_id %>").toggle(true);
                                $("#showcomments_<%= $question_id %>").html("Hide Comments");
                                console.log('Comments displayed');
                            }
                        });
                    });
                </script>
                </div>
                
            % } 
        % }
            <script>
                $(document).ready(function(){
                    var formshown = false;
                    $("#newquestion").click(function(){
                        if (formshown){
                            $("#newquestionbutton").html('+ New Question');
                            $("#content").css("padding-top", "50px");
                            $("#newquestionform").remove();
                            $("#youtube").css('left', '170px');
                            formshown = false;
                        }
                        else {
                            $("#newquestionbutton").html('- Hide');
                            $("#content").css("padding-top", "0px");
                            $("#youtube").css('left', '76px');
                            $("#bar").after(
                                "<form id='newquestionform' action='<%= url_for 'store_question' %>' method='POST'>\
                                <label for='question'>New Question</label><br>\
                                <textarea name='question' required></textarea><br>\
                                <input class='postbutton' type='submit' value='Create'></form>");
                            formshown = true;
                        }
                    });
                });
            </script>
        </div>
    </body>
</html>
=======
	<div class="header">
		<div class="logoContainer"> 
			<img class="logoImg" src="img/logo.png" alt="LOGO">
		</div>
		<div class="version">
			v<%=$self->version%>
		</div>
		<div class="youtube">
			<a href="https://www.youtube.com/channel/UCwSuyK7EsrNN02Z92bI34gA/feed" target="_blank">
				<img class="youtubeImg" src="img/youtubehover.png" alt="YOUTUBE">
			</a>
		</div>
	</div>
	
	<div class="padding"></div>
	
	<div class="newQuestion" onclick="toggleQuestionForm()">
		Ask A Question
	</div>
	
	<div class="newQuestionContainer">
		<form id='newquestionform' action='/questions' method='POST'>
			<br><label for='question' class="newPostTitle">New Question</label><br>
			<textarea placeholder= "Enter question here" class="newPostTextarea" name='question' required></textarea><br>
			<input class='postButton' type='submit' value='Create'>
		</form>
	</div>
	
	
	
	<div class="content">
		<div class= "postContainer" id="postContainer_ID">
			<div class="voteInfoContainer" id="voteInfoContainer_ID">
				<div class="upvoteContainer">
					<img class="containedImg" src="img/smalluparrow.png" alt="uparrow"
					id="upvote_ID"
					onmouseenter="changeVoteImg(ID, 'in', 'up')"
					onmouseleave="changeVoteImg(ID, 'out', 'up')"
					onclick="vote(ID, 'up')">
				</div>
				<div class="voteContainer" id="voteContainer_ID">
					VOTES
				</div>
				<div class="downvoteContainer">
					<img class="containedImg" src="img/smalldownarrow.png" alt="downarrow"
					id="downvote_ID"
					onmouseenter="changeVoteImg(ID, 'in', 'down')"
					onmouseleave="changeVoteImg(ID, 'out', 'down')"
					onclick="vote(ID, 'down')">
				</div>
			</div>
			
			<div class="buttonContainer" id="buttonContainer_ID">
				<div class="deleteButtonContainer" id="deleteButtonContainer_ID">
					<img class= "containedImg" src="img/trash.png" alt="Trash" 
					onmouseenter="this.src='img/opentrash.png'" 
					onmouseleave="this.src='img/trash.png'"
					onclick="deletePost(ID)">
				</div>
				<div class="flagButtonContainer">
					<img class= "containedImg" src="img/flag.png" alt="Flag" 
					id="flagImg_ID"
					onmouseenter="changeFlag(ID, 'in')" 
					onmouseleave="changeFlag(ID, 'out')"
					onclick="sendFlagReport(ID)">
				</div>
				<div class="answerButtonContainer" id="answerButtonContainer_ID">
					<img class="containedImg" src="img/checkmark.png" alt="Checkmark"
					id="answerImg_ID"
					onmouseenter="changeCheckMark(ID, 'in')"
					onmouseleave="changeCheckMark(ID, 'out')"
					onclick="markAnswer(ID)">
				</div>
			</div>
			
			<div class="postTextAndInfoContainer" id="postTextAndInfoContainer_ID">
				<div class="postTextContainer" id="postTextContainer_ID">
					<div class="postText" id="textContainer_ID">
					    TEXT
					</div>
				</div>
				<div class="postInfoContainer">
					<div class="postActionContainer" id="showCommentsButton_ID" onclick="toggleComments(ID)">
						show comments<br>(NUMCOMMENTS)
					</div>
					<div class="postActionContainer" id="replyButton_ID" onclick="toggleReplyForm(ID)">
						reply
					</div>
					<div class="timeAskedContainer">
						TIMEASKED
					</div>
				</div>
			</div>
		</div>
		
		<div class="replyContainer" id="replyContainer_ID">
            <label class='newPostTitle' for='comment'>Reply</label>
            <br><textarea class = "newPostTextArea" id="newPostTextArea_ID" placeholder= "Enter reply here"></textarea>
            <input type='hidden' name='question_id' value='ID'><br>
            <button class="postButton" onclick="sendReply(ID)">Post</button>
		</div>
			
		<div class="commentsContainer" id="commentsContainer_ID">
		</div>
	</div>
	<div class="singleComment">
		<div class="commentPadding" id="commentPadding_ID">
			word
		</div>
			
		<div class="commentContainer" id="commentContainer_ID">
			<div class="commentVoteInfoContainer" id="voteInfoContainer_ID">
				<div class="commentUpvoteContainer">
					<img class="containedImg" src="img/smalluparrow.png" alt="uparrow"
					id="upvote_ID"
					onmouseenter="changeVoteImg('ID', 'in', 'up')"
					onmouseleave="changeVoteImg('ID', 'out', 'up')"
					onclick="vote('ID', 'up')">
				</div>
				<div class="commentVoteContainer" id="voteContainer_ID">
					VOTES
				</div>
				<div class="commentDownvoteContainer">
					<img class="containedImg" src="img/smalldownarrow.png" alt="downarrow"
					id="downvote_ID"
					onmouseenter="changeVoteImg('ID', 'in', 'down')"
					onmouseleave="changeVoteImg('ID', 'out', 'down')"
					onclick="vote('ID', 'down')">
				</div>
			</div>
			
			<div class="commentPostTextAndInfoContainer" id="postTextAndInfoContainer_ID">
				<div class="commentPostTextContainer" id="postTextContainer_ID">
					<div class="commentPostText" id="textContainer_ID">
					    TEXT
					</div>
				</div>
					
				<div class="commentPostInfoContainer">
					<div class="commentDeleteButtonContainer" id="deleteButtonContainer_ID">
						<img class= "containedImg" src="img/trash.png" alt="Trash" 
						onmouseenter="this.src='img/opentrash.png'" 
						onmouseleave="this.src='img/trash.png'"
						onclick="deletePost('ID')">
					</div>
						
					<div class="commentFlagButtonContainer">
						<img class= "containedImg" src="img/flag.png" alt="Flag" 
						id="flagImg_ID"
						onmouseenter="changeFlag('ID', 'in')" 
						onmouseleave="changeFlag('ID', 'out')"
						onclick="sendFlagReport('ID')">
					</div>
						
					<div class="commentAnswerButtonContainer" id="answerButtonContainer_ID">
						<img class="containedImg" src="img/checkmark.png" alt="Checkmark"
						id="answerImg_ID"
						onmouseenter="changeCheckMark('ID', 'in')"
						onmouseleave="changeCheckMark('ID', 'out')"
						onclick="markAnswer('ID')">
					</div>
						
					<div class="commentTimeAskedContainer">
						TIMEASKED
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
>>>>>>> 0d29edfb7dabe528a1c1c55e9e8085068f6819be
