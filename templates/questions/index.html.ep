<!DOCTYPE HTML>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
	<script src="/js/scripts.js"></script>
	<link rel="stylesheet" media="screen and (max-device-width: 800px)" href="/css/style.css">
	<link rel="stylesheet" media="screen and (min-device-width: 800px)" href="/css/desktop.css">
</head>
<title>Ask Me Anything</title>
<script>
$(document).ready(function() {
	//extracts html from page and stores it in global variables
	HTMLforPost = $(".singlePost").html();
    $(".singlePost").remove();
    HTMLforComment = $(".singleComment").html();
    $(".singleComment").remove();
    
    //hides all containers that are needed to be hidden
	$(".newQuestionContainer").hide();
	$(".singleComment").remove();
	$(".singlePost").remove();
	$(".sortMenuContainer").hide();
	$(".backgroundCover").hide();
	$(".searchBar").hide();
	$(".replyMenuContainer").hide();
	$(".privacyPolicyContainer").hide();
	
    setCurrentUser("<%=session 'username'%>");
    setAdmin("<%=session 'admin'%>");
    setVoteFloor("<%= $self->config->{vote_floor}%>");
    
    //this is where it should set the last viewed options, something like that with cookies
    reloadQuestions();
    
    $(window).resize(function() {
    	resizePosts();
    	for(var i = 0; i < getQuestionCount(); i ++) {
    		if(getQuestion(i).getCommentsShown()) {
    			resizeComments(getQuestion(i).getId());
    		}
    	}
    });
    
    var scrolled = false;   //did the user recently scroll
    var lastTop = 0;        //last top of view window in pixels
    
    $(window).scroll(function(event){
	    scrolled = true;
	});

	setInterval(function() {
	    if (scrolled && deviceType == 'mobile') {
	        var top = $(this).scrollTop();
	        
	        //if the use scrolls own, hide the header and move all fixed elements beneath it upwards
	        // also makes sure that they are not too close to the top for the header to be hidden
	        if(lastTop < top && top > 90) {
	    	 	$(".header").css('top', '-100px');
	        	$(".filterContainer").css('top', '0');
	        	$(".newQuestionContainer").css('top', '100px');
	        }
	        //if the user scrolls up, reveal the header and move the filter container down 
	        else {
	        	$(".header").css('top', '0');
	        	$(".filterContainer").css('top', '100px');
	        	$(".newQuestionContainer").css('top', '200px');
	        }
	        
	        lastTop = top;
	        scrolled = false;
	    }
	}, 250);  //this number is the number of ms before checking if the user scrolled. The higher this number is, the slower the site will run

	//Whenever someone makes a change to one of the time inputs on the time menu
	//  this function is called and it changes the link appropriately
	$(".replyMenuTimeInput").bind('input propertychange', function() {
    	setReplyMenuTimes($("#replyMenuLinkTextarea").val());
	});
});
</script>

<body>
	<div class="header" >
		<div class="headerImgContainer menuButtonContainer">
			<img class="containedImg headerImg" src="/img/menubutton.png" alt="menu" onclick="showSortMenu()">
		</div>
		<div class="headerImgContainer searchButtonContainer">
			<img class="containedImg headerImg" src="/img/searchbutton.png" alt="search" onclick="toggleSearchBar()">
		</div>
		<div class="headerImgContainer newQuestionButtonContainer">
			<img class="containedImg headerImg" src="/img/newQuestion.png" alt='new question' onclick="toggleQuestionForm()">
		</div>
		<div class="headerImgContainer accountButtonContainer" onclick="window.location = '/account'">
			<img class="containedImg headerImg" src="/img/account.png" alt="account">
		</div>
	</div>
	
	<div class="searchBar">
		<textarea rows="1" placeholder="search" class="searchTextArea" id="searchTextarea" required></textarea>
		<button class="searchButton" onclick="search()">search</button>
	</div>
	
	<div class="newQuestionContainer">
		<br><label for='question' class="newPostTitle">New Question</label><br>
		<textarea placeholder= "Enter Question" class="newPostTextarea" id="newQuestionTextarea" rows=3 required></textarea><br>
		<button class='postButton' onclick="submitQuestion()">Submit</button>
	</div>
	
	<div class="backgroundCover" onclick="closeMenu('none')">
	</div>
	
	<div class="sortMenuContainer">
		<div class="sortMenuTitle">
			Sort Options
		</div>
		
		<div class="sortMenuOptionsContainer">
			<div class="sortMenuOption" id="creator_all" onclick="changeFilter('creator', 'all')">
				all
			</div><div class="sortMenuOption" id="creator_my" onclick="changeFilter('creator', 'my')">
			mine</div>
		</div>
		<div class="sortMenuOptionsContainer">
			<div class="sortMenuOption" id="answered_1" onclick="changeFilter('answered', 1)">
				answered
			</div><div class="sortMenuOption" id="answered_0" onclick="changeFilter('answered', 0)">
			unanswered</div>
		</div>
		
		<div class= "sortMenuTitle">
			votes
		</div>
		
		<div class="sortMenuOptionsContainer">
			<div class="sortMenuOption" id="votes_desc" onclick="changeFilter('orderby', 'votes');changeFilter('direction', 'desc')">
				popular
			</div><div class="sortMenuOption" id="votes_asc" onclick="changeFilter('orderby', 'votes');changeFilter('direction', 'asc')">
			unpopular</div>
		</div>
		
		<div class= "sortMenuTitle">
			date
		</div>
		
		<div class="sortMenuOptionsContainer">
			<div class="sortMenuOption" id="created_asc" onclick="changeFilter('orderby', 'created');changeFilter('direction', 'asc')">
				old
			</div><div class="sortMenuOption" id="created_desc" onclick="changeFilter('orderby', 'created');changeFilter('direction', 'desc')">
			new</div>
		</div>
		
		<div class="sortMenuButton">
			<div class="sortMenuButtonText" onclick="closeMenu('cancel')">
				Cancel
			</div>
		</div><div class="sortMenuButton">
			<div class="sortMenuButtonText" onclick="closeMenu('save')">
				Apply
			</div>
		</div>
		
	</div>
	
	<div class="filterContainer">
		<div class="filterName">
			filter
		</div>
	</div>
	
	<div class="replyMenuContainer">
		<div class="replyMenuTitle">
			ATTENTION
		</div>
		<div class="replyMenuDescription">
			A youtube link has been detected in your reply. Please check the information below:
		</div>
		<div class="replyMenuLinkContainer">
			Link:</br><textarea class="replyMenuTextarea" id="replyMenuLinkTextarea" rows=3 placeholder="link goes here"></textarea>
		</div>
		<div class="replyMenuStartingTimeContainer">
			Starting Time:</br>
			<input class="replyMenuTimeInput" onclick="$(this).select();" id="replyMenuTimeHr" type="number" placeholder="0" rows=1></input> hr
			<input class="replyMenuTimeInput" onclick="$(this).select();" id="replyMenuTimeMin" type="number" placeholder="0" rows=1></input> min
			<input class="replyMenuTimeInput" onclick="$(this).select();" id="replyMenuTimeS" type="number" placeholder="0" rows=1></input> s
		</div>
		<div class="replyMenuSecondDescription">
			The link will be removed from your reply and mapped to a button.
		</div>
		<div class="replyMenuButtonsContainer">
			<div class="replyMenuButton" onclick="readyToSubmit.resolve('')">leave it in</div><div class="replyMenuButton" onclick="readyToSubmit.resolve(' save ')">add button</div>
		</div>
	</div>
	
	<div class="privacyPolicyContainer">
		<div class="privacyTitle">
			Privacy Policy
		</div>
		<div class="privacyContent">
			Here is the content of the privacy policy. It is kinda long, so we gotta make sure it wraps. Hopefully people really like this privacy policy. Hopefully it does not scare people away.
		</div>
		<button class="closePrivacyButton" onclick="closeMenu('none')">
			Close
		</button>
	</div>
	
	<div class="content">
		
	</div>
	
	<div class="showMoreButton" onclick="showMore()">
		show more
	</div>
	
	<footer class="footer">
		<div class="logoContainer"> 
			<img class="containedImg" src="/img/logo.png" alt="LOGO">
		</div>
		<a href="https://www.youtube.com/channel/UCwSuyK7EsrNN02Z92bI34gA/feed" target="_blank">
			<div class="youtubeContainer">
				<img src="/img/lightYoutube.png" alt="youtube" class="inline containedImg" > KSTN
			</div>
		</a>
		<div class="privacyPolicyButtonContainer linkContainer" onclick="showPrivacyPolicy()">
			Privacy Policy
		</div>
		<a href="https://www.keystone-technologies.com/" target="_blank">
			<div class="websiteContainer linkContainer">
				Company Website
			</div>
		</a>
		<div class="feedbackButtonContainer linkContainer" onclick="console.log('not yet implemented!');">
			Submit Feedback
		</div>
		<div class="version">
			v<%=$self->version%>
		</div>
	</footer>
	
	<!-- All html under here is extracted by the js, parsed and used for comments and questions, then reinserted into the page -->

	<div class="singlePost">
		<div class= "postContainer" id="postContainer_TYPEID">
			<div class="voteInfoContainer" id="voteInfoContainer_TYPEID">
				<div class="upvoteContainer">
					<img class="containedImg" src="/img/smalluparrow.png" alt="uparrow"
					id="upvote_TYPEID"
					onmouseenter="changeVoteImg('TYPE', ID, 'in', 'up')"
					onmouseleave="changeVoteImg('TYPE', ID, 'out', 'up')"
					onclick="vote('TYPE', ID, 'up')">
				</div>
				<div class="voteContainer" id="voteContainer_TYPEID">
					VOTES
				</div>
				<div class="downvoteContainer">
					<img class="containedImg" src="/img/smalldownarrow.png" alt="downarrow"
					id="downvote_TYPEID"
					onmouseenter="changeVoteImg('TYPE', ID, 'in', 'down')"
					onmouseleave="changeVoteImg('TYPE', ID, 'out', 'down')"
					onclick="vote('TYPE', ID, 'down')">
				</div>
				<div class="linkButtonContainer" id="linkButtonContainer_TYPEID">
					<a href="LINK" target='_blank'>
					<img class= "containedImg" src="/img/youtubebutton.png" alt="youtube" 
					title="video answer"
					onmouseenter="this.src='/img/youtubebuttonhover.png'" 
					onmouseleave="this.src='/img/youtubebutton.png'" >
					</a>
				</div>
			</div>
			<div class="buttonContainer" id="buttonContainer_TYPEID">
				<div class="deleteButtonContainer" id="deleteButtonContainer_TYPEID">
					<img class= "containedImg" src="/img/trash.png" alt="delete" 
					onmouseenter="this.src='/img/opentrash.png'" 
					onmouseleave="this.src='/img/trash.png'" 
					onclick="deletePost('TYPE', ID)">
				</div>
			</div>
			
			<div class="postTextAndInfoContainer" id="postTextAndInfoContainer_TYPEID">
				<div class="postTextContainer" id="postTextContainer_TYPEID">
					<div class="postText" id="textContainer_TYPEID">
					    TEXT
					</div>
				</div>
				<div class="postInfoContainer">
					<div class="postActionContainer" id="showCommentsButton_TYPEID" onclick="toggleComments(ID)">
						show comments<br>(NUMCOMMENTS)
					</div>
					<div class="postActionContainer" id="replyButton_TYPEID" onclick="toggleReplyForm(ID)">
						reply
					</div>
					<div class="timeAskedContainer" id="timeAskedContainer_TYPEID">
						TIMEASKED
					</div>
				</div>
			</div>
		</div>
		
		<div class="replyContainer" id="replyContainer_TYPEID">
            <label class='newPostTitle' for='comment'>Reply</label>
            <br><textarea class = "newPostTextarea" id="newPostTextArea_TYPEID" placeholder= "Enter reply here"></textarea><br>
            <button class="postButton" onclick="readyReply(ID)">Post</button>
		</div>
			
		<div class="commentsContainer" id="commentsContainer_TYPEID">
		</div>
	</div>
	
	<div class="singleComment">
		<div class="commentContainer" id="commentContainer_TYPEID">
			<div class="commentVoteInfoContainer" id="voteInfoContainer_TYPEID">
				<div class="commentUpvoteContainer">
					<img class="containedImg" src="/img/smalluparrow.png" alt="uparrow"
					id="upvote_TYPEID"
					onmouseenter="changeVoteImg('TYPE', ID, 'in', 'up')"
					onmouseleave="changeVoteImg('TYPE', ID, 'out', 'up')"
					onclick="vote('TYPE', ID, 'up')">
				</div>
				<div class="commentVoteContainer" id="voteContainer_TYPEID">
					VOTES
				</div>
				<div class="commentDownvoteContainer">
					<img class="containedImg" src="/img/smalldownarrow.png" alt="downarrow"
					id="downvote_TYPEID"
					onmouseenter="changeVoteImg('TYPE', ID, 'in', 'down')"
					onmouseleave="changeVoteImg('TYPE', ID, 'out', 'down')"
					onclick="vote('TYPE', ID, 'down')">
				</div>
			</div>
			
			<div class="commentPostTextAndInfoContainer" id="postTextAndInfoContainer_TYPEID">
				<div class="commentPostTextContainer" id="postTextContainer_TYPEID">
					<div class="commentPostText" id="textContainer_TYPEID">
					    TEXT
					</div>
				</div>
					
				<div class="commentPostInfoContainer">
					<div class="commentDeleteButtonContainer" id="deleteButtonContainer_TYPEID">
						<img class= "containedImg" src="/img/trash.png" alt="delete" 
						onmouseenter="this.src='/img/opentrash.png'" 
						onmouseleave="this.src='/img/trash.png'" 
						onclick="deletePost('TYPE', ID)">
					</div>
						
					<div class="commentLinkButtonContainer" id="linkButtonContainer_TYPEID">
						<a href="LINK" target='_blank'>
						<img class= "containedImg" src="/img/youtubebutton.png" alt="youtube link" 
						title="go to video"
						onmouseenter="this.src='/img/youtubebuttonhover.png'"
						onmouseleave="this.src='/img/youtubebutton.png'">
						</a>
					</div>
						
					<div class="commentAnswerButtonContainer" id="answerButtonContainer_TYPEID">
						<img class="containedImg" src="/img/checkmark.png" alt="Checkmark"
						id="answerImg_TYPEID"
						onmouseenter="changeCheckMark(ID, 'in')"
						onmouseleave="changeCheckMark(ID, 'out')"
						onclick="markAnswer(ID)">
					</div>
						
					<div class="commentTimeAskedContainer">
						TIMEASKED
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
